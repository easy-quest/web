## ПРОВЕРКА УСЛОВИЙ В BASH

>   Bash/Python/PHP

При написании скриптов практически всегда имеется необходимость в
проверке (ветвлении) каких либо процессов, другими словами — «делать это
или не делать? а если делать, то что?». В интернете достаточно много
информации о операторах ifthenelse, которые и позволяют нам
манипулировать ходом выполнения нашего скрипта. Тут главное понять «как
это работает», все остальное приходит с практикой. Оговорюсь — не
претендую на истину, потому что bash только изучаю, не один из примеров
не несет сакраментального характера, все они сделаны для наглядности.

### Операторы ifthen и else

Операторы ifthen проверяют код завершения
списка команд на «успешное завершение (истина)» что в свою очередь
означает «0», и если это так, то выполняет одну или более команд
следующих за словом then. Если проверка возвращает «не успешное
завершение (ложь)» что в свою очередь означает «1» выполняется else
«иначе», если того требует условие. В завершении условия обязательно
закрываем его «fi»!
Все выше написанное возможно будет понятно не сразу, но когда дальше по
статье пойдут примеры, все станет на свои места.

### Скобки

[ — является специальной встроенной командой test воспринимающей свои
аргументы как выражение сравнения или файловую проверку […..].

[[ — расширенный вариант от «[«, является зарезервированным словом, а не
командой, его bash выполняет как один элемент с кодом возврата. Внутри
«[[….]]» разрешается выполнение операторов &&,  которые приводят к
ошибке в обычных скобках «[….]» тем самым вариант с двойной скобкой
более универсален.

(( — является арифметическими выражениями, которое так же возвращают код
0. Тем самым такие выражения могут участвовать в операциях сравнения.

Приведу список логических операторов, которые используются для
ifthenelse:

-Z  — строка пуста

-N — строка не пуста

=, ( == ) — строки равны

!=  — строки неравны

-EQ — равно

-NE — неравно

-LT,(< ) — меньше

-LE,(<=) — меньше или равно

-GT,(>) — больше

-GE,(>=) — больше или равно

! — отрицание логического выражения

-A,(&&) — логическое «И»

-O,() — логическое «ИЛИ»

### КОНСТРУКЦИИ ПРОСТОЙ ПРОВЕРКИ `IFTHEN`

`if [[ condition ]]; then commands fi`


```bash
if [[ condition ]]; then                                            
 commands                                                                      
fi
```                                                             
                                                                      
**ДРУГИМИ СЛОВАМИ:**

если проверяемое_выражение_или_команды_верны; то выполняем команды
закрываем если

**ПРИМЕР 1**

```
#!/bin/bash if echo Тест; then echo 0 fi
```
```bash
#!/bin/bash                       
                                                                        
if echo Тест; then                
echo 0                                                                       
fi
```                                                                                                    
                                                                            
                                                 
                                                        
                                                        Часто встречается в скриптах проверка — «существует ли файлы или
каталоги» на их примере покажу работу

**ПРИМЕР**

#!/bin/bash if [ -f $HOME/.bashrc ]; then echo "Файл существует!" fi


                                  #!/bin/bash                       
                                                                      
                                   if [ -f $HOME/.bashrc ]; then     
                                                                      
                                   echo "Файл существует!"           
                                                                      
 4                                  fi                                


где:

$HOME/.BASHRC — путь до файла
ECHO — печатает сообщение в консоль

**ПРИМЕР **

#!/bin/bash if [[ -f $HOME/.bashrc && -f /usr/bin/nano ]]; then echo
"Все впорядке, можно редактировать!" fi


                                  #!/bin/bash                       
                                                                      
                                   if [[ -f $HOME/.bashrc && -f      
                                    /usr/bin/nano ]]; then            
                                                                     
                                    echo "Все впорядке, можно         
 4                                  редактировать!"                   
                                                                      
                                    fi                                


где:

&& — логическое «и», если первый путь «истина» проверяем второй, если он
тоже «истина», то выполняем команды (echo)
-F  —  ключ проверки на существования файла (о них чуть ниже)

### Конструкции простой проверки ifthenelse

if [[ condition ]]; then commands 1 else commands  fi


                                  if [[ condition ]]; then          
                                                                      
                                       commands 1                    
                                                                      
                                   else                              
                                                                      
 4                                      commands                     
                                                                      
 5                                  fi                                


другими словами:

если проверяемое_выражение_или_команды_верны; то команды 1 иначе команды
 закрываем если

**ПРИМЕР 4**

Возможно не лучший пример, нас интересует именно ответ 0 или 1. В
результате печатается в консоль «Тест» и «0» потому что команда «echo
Тест» успешна и это «истина».

#!/bin/bash if echo Тест; then echo 0 else echo 1 fi


                                  #!/bin/bash                       
                                                                      
                                   if echo Тест;                     
                                                                      
                                       then echo 0                   
                                                                      
 4                                  else                              
                                                                      
 5                                      echo 1                        
                                                                      
 6                                  fi                                


Намерено допустите ошибку изменив echo, в результате получите «1» и
сообщение о том что «команда echo не существует» и это «ложь».

#!/bin/bash if echo Тест; then echo 0 else echo 1 fi


                                  #!/bin/bash                       
                                                                      
                                   if echo Тест; then                
                                                                      
                                       echo 0                        
                                                                      
 4                                  else                              
                                                                      
 5                                      echo 1                        
                                                                      
 6                                  fi                                


### Примеры «существуют ли файл?»

**ПРИМЕР 5**

Если файл bashrc существует, то печатает в консоль «Файл существует!»,
иначе печатает «Файл не существует!»

#!/bin/bash if [ -f "$HOME/.bashrc" ]; then echo "Файл существует!" else
echo "Файл не существует!" fi


                                  #!/bin/bash                       
                                                                      
                                   if [ -f "$HOME/.bashrc" ]; then   
                                                                      
                                       echo "Файл существует!"       
                                                                      
 4                                  else                              
                                                                      
 5                                      echo "Файл не существует!"    
                                                                      
 6                                  fi                                


Поиграйте с именем проверяемого файла

**ПРИМЕР 5**

#!/bin/bash if [[ -f "$HOME/.bashrc" && -f "/usr/bin/nano" ]]; then echo
"Все в порядке, можно редактировать!" else echo "Ошибка!" fi


                                  #!/bin/bash                       
                                                                      
                                   if [[ -f "$HOME/.bashrc" && -f    
                                    "/usr/bin/nano" ]]; then          
                                                                     
                                        echo "Все в порядке, можно    
 4                                  редактировать!"                   
                                                                      
 5                                  else                              
                                                                      
 6                                      echo "Ошибка!"                
                                                                      
                                    fi                                


Ключи к файлам и каталогам

[ -КЛЮЧ «ПУТЬ» ]
[ -E «ПУТЬ КАТАЛОГУ_ИЛИ_ФАЙЛУ»] — существует ли файл или каталог.

[ -R  «ПУТЬ К ФАЙЛУ/КАТАЛОГУ»] — доступен ли файл/каталог для чтения.

[ -F «ПУТЬ К ФАЙЛУ/КАТАЛОГУ»]  — существует ли файл.

[ -D «ПУТЬ К КАТАЛОГУ»] — существует ли каталог.
Полное описание возможных применений различных скобок, правильное
расставление кавычек уходит далеко от темы, поэтому могу посоветовать
обратится к руководству Advanced Bash Scripting

### Арифметика

 

**ПРИМЕР 6**

Если оператор > использовать внутри [[….]], он рассматривается как
оператор сравнения строк, а не чисел. Поэтому операторам > и < для
сравнения чисел лучше заключить в круглые скобки.

Используем круглые скобки для математического сравнение. Если «» меньше
«6» печатаем «Да».

#!/bin/bash if ((  < 6));then echo Да fi


                                  #!/bin/bash                       
                                                                      
                                   if ((  < 6));then                
                                                                      
                                       echo Да                       
                                                                      
 4                                  fi                                


 

**ПРИМЕР 7**

Использование команды test, коей являются квадратные скобки. Если «»
меньше «6» печатаем «Да».

#!/bin/bash if [  -lt 6 ]; then echo Да fi


                                  #!/bin/bash if [  -lt 6 ]; then  
                                                                      
                                       echo Да                       
                                                                      
                                   fi                                


Можно использовать и двойные квадратные скобки, это расширенный вариант
команды test, эквивалентом которой является «[ ]». Если «» меньше «6»
печатаем «Да».

#!/bin/bash if [[  -lt 6 ]]; then echo Да fi


                                  #!/bin/bash                       
                                                                      
                                   if [[  -lt 6 ]]; then            
                                                                      
                                       echo Да                       
                                                                      
 4                                  fi                                


**ПРИМЕР 8**

Используем двойные квадратные скобки, потому что применяем оператор
«&&». Если первое выражение  =  (истина) тогда выполняем второе, и
если оно тоже = (истина), печатаем «Верно»

#!/bin/bash a="" b="" if [[  = "$a" &&  = "$b" ]] ; then echo Верно
else echo Не верно fi


                                  #!/bin/bash                       
                                                                      
                                   a=""                             
                                                                      
                                   b=""                             
                                                                      
 4                                  if [[  = "$a" &&  = "$b" ]] ;   
                                    then                              
 5                                                                    
                                        echo Верно                    
 6                                                                    
                                    else                              
 7                                                                    
                                        echo Не верно                 
 8                                                                    
                                    fi                                


Если первое выражение  =  (истина) тогда выполняем второе, и если
переменная «b» не равна двум (ложь), печатаем «Не верно»

#!/bin/bash a="" b="" if [[  = "$a" &&  = "$b" ]] ; then echo Верно
else echo Не верно fi

Bash
                                  #!/bin/bash                       
                                                                      
                                   a=""                             
                                                                      
                                   b=""                             
                                                                      
 4                                  if [[  = "$a" &&  = "$b" ]] ;   
                                    then                              
 5                                                                    
                                        echo Верно                    
 6                                                                    
                                    else                              
 7                                                                    
                                        echo Не верно                 
 8                                                                    
                                    fi                                


 

Можно конечно сделать проще, нам главное понять принцип ifthen и else,
не стесняйтесь менять, подставляя свои значения.

### Вложение нескольких проверок

 

 `Bash`  позволяет вкладывать в блок несколько блоков

```Bash
#!/bin/bash if [[ condition 1 ]]; then if [[ condition  ]]; then
command 1 else command  fi else command  fi
```


```bash
#!/bin/bash                       
                                                                      
if [[ condition 1 ]]; then        
                                                                      
if [[ condition  ]]; then    
                                                                      
command 1                 
                                                                      
else                          
                                                                      
command                  
else                              
                                                                      
command  3                    
                                                                      
fi
```                                


### Построения многоярусных конструкций

Для построения многоярусных конструкции, когда необходимо выполнять
множество проверок лучше использовать `elif` — это краткая форма записи
конструкции `else if`.


```bash
if [[ condition 1 ]]; then        
                                                                      
command 2                                                        
command 2                     
                                                                      
elif [[ condition  ]]; then      
                                                                      
command 3                     
                                                                      
command 4                     
                                                                      
else                              
                                                                      
command 5                     
                                                                      
fi
```                                


 

Взято с http://itbuben.org/blog/Unix-way/807.html
